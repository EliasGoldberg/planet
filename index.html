<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>threeDee</title>
</head>
<body>
<canvas id='gl'
        style='width:400px; height:300px;
                   border: solid 1px black;' />
<script src="http://code.jquery.com/jquery-2.1.1.min.js"></script>
<script src="http://coffeescript.org/extras/coffee-script.js"></script>
<script type="text/coffeescript">
  main = () ->
    canvas = document.getElementById('gl')
    gl = canvas.getContext('experimental-webgl')
    program = new Program(gl)

    program.addShader(gl.VERTEX_SHADER,'''
      attribute vec4 a_Position;
      void main() {
           gl_Position = a_Position;
           gl_PointSize = 10.0;
      }
    ''')

    program.addShader(gl.FRAGMENT_SHADER,'''
      void main() {
        gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);
      }
    ''')

    program.activate()
    program.addAttrib('a_Position')

    gl.clearColor(0.0,0.0,0.0,1.0)
    gl.clear(gl.COLOR_BUFFER_BIT)
    program.setAttrib('a_Position',[0.0,0.0,0.0])
    gl.drawArrays(gl.POINTS, 0, 1)

  class Program
    constructor: (@gl) ->
      @program = @gl.createProgram()
      @attribs = []

    addShader: (type,source) ->
      shader = @gl.createShader(type)
      @gl.shaderSource(shader,source)
      @gl.compileShader(shader)
      message = @gl.getShaderInfoLog(shader)
      console.log message if message? and message != ''
      @gl.attachShader(@program,shader)

    activate: ->
      @gl.linkProgram(@program)
      message = @gl.getProgramInfoLog(@program)
      console.log message if message? and message != ''
      @gl.useProgram(@program)

    addAttrib: (name) -> @attribs[name] = @gl.getAttribLocation(@program,name)
    setAttrib: (name,value) -> @gl.vertexAttrib3fv(@attribs[name],value)

  $(main)
</script>
</body>
</html>